DROP INDEX IF EXISTS "USER_AUTHORIZATION_PK";
DROP INDEX IF EXISTS "USER_AUTHORIZATION_HISTORY_PK";


CREATE SEQUENCE IF NOT EXISTS USER_AUTHORIZATION_SEQ START WITH 1 INCREMENT BY 1;

--------------------------------------------------------
--  DDL for Table USER_AUTHORIZATION
--------------------------------------------------------

CREATE TABLE IF NOT EXISTS "USER_AUTHORIZATION" 
   (	
    "ID" INT PRIMARY KEY generated by default as identity (start with 1), --DEFAULT USER_AUTHORIZATION_SEQ.NEXTVAL,
	"CLIENT_ID" VARCHAR(50) not null, 
	"KEY_TYPE" CHAR(1) not null, 
	"CREATED_ON" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, 
	"ASYM_KEY" BLOB not null, 
	"EXPIRATION" TIMESTAMP (6), 
	"DESCRIPTION" VARCHAR(255) not null,
	"KEY_ALGORITHM" VARCHAR(10) DEFAULT 'RSA'
	);


--------------------------------------------------------
--  DDL for Index USER_AUTHORIZATION_PK
--------------------------------------------------------
--CREATE UNIQUE INDEX IF NOT EXISTS "USER_AUTHORIZATION_PK" ON "USER_AUTHORIZATION" ("ID");

--------------------------------------------------------
--  Constraints for Table USER_AUTHORIZATION
--------------------------------------------------------

--ALTER TABLE "USER_AUTHORIZATION" ADD CONSTRAINT IF NOT EXISTS "USER_AUTHORIZATION_PK" PRIMARY KEY ("ID");
  
--------------------------------------------------------
--  DDL for history table
--------------------------------------------------------

CREATE TABLE IF NOT EXISTS USER_AUTHORIZATION_HISTORY 
(
  ID INT NOT NULL 
, CLIENT_ID VARCHAR(50) NOT NULL 
, KEY_TYPE CHAR(1) NOT NULL 
, CREATED_ON TIMESTAMP(6) NOT NULL 
, ASYM_KEY BLOB NOT NULL 
, EXPIRATION TIMESTAMP(6) NOT NULL 
, DESCRIPTION VARCHAR(255) NOT NULL
, KEY_ALGORITHM VARCHAR(10)
, DEPRECATED_ON TIMESTAMP NOT NULL 
,PRIMARY KEY (CLIENT_ID,DEPRECATED_ON)
);

--CREATE UNIQUE INDEX USER_AUTHORIZATION_HISTORY_PK ON USER_AUTHORIZATION_HISTORY (CLIENT_ID ASC, DEPRECATED_ON );

--ALTER TABLE "USER_AUTHORIZATION_HISTORY" ADD CONSTRAINT "USER_AUTHORIZATION_HISTORY_PK" PRIMARY KEY ("CLIENT_ID", "DEPRECATED_ON");